---
import '../../styles/global.css';
---

<html lang="en" class="dark bg-zinc-950 text-zinc-100">
  <body class="flex items-center justify-center min-h-screen">
    <div class="text-center">
      <div class="inline-block w-8 h-8 border-4 border-t-blue-500 border-zinc-800 rounded-full animate-spin mb-4"></div>
      <p class="text-zinc-400 font-medium">Finalizing your session...</p>
    </div>

    <script>
      function handleCallback() {
        // 1. Ищем token, который прислал бэкенд
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');

        if (!token) {
          console.error("No token found in URL");
          window.location.href = '/login?error=no_token';
          return;
        }

        // 2. Сохраняем JWT (теперь он у нас в localStorage)
        localStorage.setItem('signalql_token', token);
        
        // 3. (Опционально) Очищаем URL, чтобы JWT не висел в истории браузера
        window.history.replaceState({}, document.title, window.location.pathname);

        // 4. Сразу на дашборд
        window.location.href = '/signals'; 
      }

      // Вызываем сразу, fetch больше не нужен!
      handleCallback();
    </script>
  </body>
</html>